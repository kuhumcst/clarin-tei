{"version":3,"sources":["dk/cst/cuphic/xml.cljc"],"mappings":"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","names":["dk.cst.cuphic.xml/Document","js/Document","dk.cst.cuphic.xml/Element","js/Element","dk.cst.cuphic.xml/Text","js/Text","dk.cst.cuphic.xml/Comment","js/Comment","dk.cst.cuphic.xml/Node","js/Node","dk.cst.cuphic.xml/parser","js/DOMParser","dk.cst.cuphic.xml/keywordize","s","vec__44714","cljs.core.nth","s1","s2","clojure.string.split","cljs.core.keyword","dk.cst.cuphic.xml/dom-parse","xml","dk.cst.cuphic.xml/attribute-objects","node","dk.cst.cuphic.xml/attribute-key","attribute","dk.cst.cuphic.xml/attribute-val","dk.cst.cuphic.xml/node-attrs","cljs.core.into","iter__5522__auto__","s__44756","cljs.core/LazySeq","temp__5804__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5520__auto__","size__5521__auto__","cljs.core/count","b__44758","cljs.core/chunk-buffer","i__44757","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__44755","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","dk.cst.cuphic.xml/node-tag","dk.cst.cuphic.xml/node-content","dk.cst.cuphic.xml/node-data","dk.cst.cuphic.xml/whole-text","dk.cst.cuphic.xml/node->hiccup","pred__44802","expr__44803","js/Error","cljs.core/instance?","cljs.core.map","map__44805","cljs.core/--destructure-map","cljs.core.get","tag","attrs","content","cljs.core.remove","cljs.core/nil?","clojure.string/blank?","dk.cst.cuphic.xml/parse","cljs.core/chunk-first"],"sourcesContent":["(ns dk.cst.cuphic.xml\n  \"Clojure(Script) implementation of an XML parser that, more or less directly,\n  converts an XML file into Hiccup data without trying to be clever about it.\n\n  Comments and superfluous whitespace are deliberately not preserved, while\n  namespaces are converted into regular Clojure namespaces. No attempt is made\n  to map namespace URIs to namespace aliases.\n\n  See: https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\"\n  (:require [clojure.string :as str])\n  #?(:clj (:import [org.w3c.dom Document Element Text Comment Node NamedNodeMap]\n                   [javax.xml.parsers DocumentBuilderFactory DocumentBuilder]\n                   [java.io ByteArrayInputStream InputStream File])))\n\n#?(:cljs (do\n           (def Document js/Document)\n           (def Element js/Element)\n           (def Text js/Text)\n           (def Comment js/Comment)\n           (def Node js/Node)))\n\n(def parser\n  #?(:clj  (.newDocumentBuilder (DocumentBuilderFactory/newInstance))\n     :cljs (js/DOMParser.)))\n\n(defn keywordize\n  \"Keywordize `s` converting XML namespaces to Clojure namespaces.\"\n  [s]\n  (let [[s1 s2] (str/split s #\":\")]\n    (if s2\n      (keyword s1 s2)\n      (keyword s1))))\n\n(defn dom-parse\n  \"Parse `xml` into a DOM tree.\"\n  [xml]\n  #?(:clj  (cond\n             (string? xml)\n             (dom-parse (ByteArrayInputStream. (.getBytes xml)))\n\n             (instance? InputStream xml)\n             (.parse ^DocumentBuilder parser ^InputStream xml)\n\n             (instance? File xml)\n             (.parse ^DocumentBuilder parser ^File xml))\n\n     :cljs (.-firstChild (.parseFromString parser xml \"text/xml\"))))\n\n(defn attribute-objects\n  \"Retrieve the raw attribute objects from the `node`.\"\n  [^Node node]\n  #?(:clj  (let [named-node-map (.getAttributes node)]\n             (for [n (range (.getLength named-node-map))]\n               (.item named-node-map n)))\n     :cljs (.-attributes node)))\n\n(defn attribute-key\n  \"Retrieve the key from the `attribute` object.\"\n  [^Node attribute]\n  #?(:clj  (.getNodeName attribute)\n     :cljs (.-name attribute)))\n\n(defn attribute-val\n  \"Retrieve the value from the `attribute` object.\"\n  [^Node attribute]\n  #?(:clj  (.getNodeValue attribute)\n     :cljs (.-value attribute)))\n\n(defn node-attrs\n  \"Get a Hiccup attributes map from a `node`.\"\n  [^Node node]\n  (into {} (for [attribute (attribute-objects node)]\n             [(keywordize (attribute-key attribute))\n              (attribute-val attribute)])))\n\n(defn node-tag\n  \"Get a Hiccup tag from a `node`.\"\n  [^Node node]\n  (keywordize #?(:clj  (.getNodeName node)\n                 :cljs (.-tagName node))))\n\n(defn node-content\n  \"Get the children of the `node` as objects.\"\n  [^Node node]\n  #?(:clj  (let [node-list (.getChildNodes node)]\n             (for [n (range (.getLength node-list))]\n               (.item node-list n)))\n     :cljs (.-childNodes node)))\n\n(defn node-data\n  \"Return the data of a `node`. Mimics the return value of clojure.data.xml.\"\n  [^Node node]\n  {:tag     (node-tag node)\n   :attrs   (node-attrs node)\n   :content (node-content node)})\n\n(defn whole-text\n  [^Text node]\n  #?(:clj  (.getWholeText node)\n     :cljs (.-wholeText node)))\n\n(defn node->hiccup\n  \"Recursively convert a `node` and its children to Hiccup.\"\n  [node]\n  (condp instance? node\n\n    Document\n    #?(:clj  (node->hiccup\n               (doto (.getDocumentElement ^Document node)\n                 (.normalize)))\n\n       ;; TODO: is the CLJS part relevant?\n       :cljs (map node->hiccup (node-content node)))\n\n    Element\n    (let [{:keys [tag attrs content]} (node-data node)]\n      (->> (map node->hiccup content)\n           (remove nil?)\n           (into [tag attrs])))\n\n    ;; TODO: should probably escape HTML here\n    Text\n    (let [s (whole-text node)]\n      (when (not (str/blank? s))\n        s))\n\n    Comment\n    nil\n\n    :else node))\n\n(defn parse\n  \"Parse `xml` as hiccup data.\"\n  [xml]\n  (node->hiccup (dom-parse xml)))\n\n(comment\n  (-> (clojure.java.io/resource \"examples/tei/test-1307-anno-tei.xml\")\n      (clojure.java.io/file)\n      (parse))\n  #_.)\n"]}