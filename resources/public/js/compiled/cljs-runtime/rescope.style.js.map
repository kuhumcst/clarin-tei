{"version":3,"sources":["rescope/style.cljc"],"mappings":";AAIA;;;gCAAA,hCAAMA,wEAEHC;AAFH,AAGE,kCAAA,aAAA,xCAACC,uBAAYD;;AAGf;;;;yCAAA,zCAAME,0FAGHC,OAAOH;AAHV,AAIE,eAAA,XAAMI;2BAAN,vBACMC;uBADN,nBAEMC;IACAC,aAAiB,WAAKC;AAAL,AACE,oBAAI,iBAAAC,oBAAK,OAASD;AAAd,AAAA,GAAAC;AACK,OAACC,qBAAWJ,iBAAiBE;;AADlCC;;;AAEF,OAACE,sBAAcR,OAAOK;;AACtBA;;;AAP3B,AAQE,QAAMR,JAAIY;IAAAA,QACJ,AAACC,iBAAOT,SAASQ;IADbA,QAEJ,iBAAAE,qBAAA,+DAAAC;AAAA,AAAA,YAAAC,kBAAA,KAAA;AAAA,AAAA,IAAAD,eAAAA;;AAAA,AAAA,IAAAE,qBAAA,AAAAC,cAAAH;AAAA,AAAA,GAAAE;AAAA,AAAA,IAAAF,eAAAE;AAAA,AAAA,GAAA,AAAAE,6BAAAJ;AAAA,IAAAK,kBAm7EyC,AAAA8D,sBAAAnE;IAn7EzCM,qBAAA,AAAAC,gBAAAF;IAAAG,WAAA,AAAAC,uBAAAH;AAAA,AAAA,GAAA,AAAA,iBAAAI,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAJ;AAAA,IAAAK,aAAA,AAAAC,eAAAP,gBAAAK;QAAA,AAAAG,4CAAAF,WAAA,IAAA,/DAAOY;eAAP,AAAAV,4CAAAF,WAAA,IAAA,tEAASa;kBAAT,AAAAX,4CAAAF,WAAA,IAAA,zEAAkBc;AAAlB,AAAA,AAAA,AAAAX,uBAAAN,SAAA,mFACG,iBAAAT,qBAAA;oFAAA2B;AAAA,AAAA,YAAAzB,kBAAA,KAAA;;AAAA,AAAA,IAAAyB,eAAAA;;AAAA,AAAA,IAAAxB,yBAAA,AAAAC,cAAAuB;AAAA,AAAA,GAAAxB;AAAA,AAAA,IAAAwB,eAAAxB;AAAA,AAAA,GAAA,AAAAE,6BAAAsB;AAAA,IAAArB,sBAk7EsC,AAAA8D,sBAAAzC;IAl7EtCpB,yBAAA,AAAAC,gBAAAF;IAAAsB,WAAA,AAAAlB,uBAAAH;AAAA,AAAA,GAAA,AAAA,iBAAAsB,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAtB;AAAA,sBAAA,AAAAM,eAAAP,oBAAAuB,rDAAMM;AAAN,AAAA,AAAA,AAAApB,uBAAAa,SACE,AAACQ,4CAAI3C,WAAW0C;;AADlB,eAAA,CAAAN,WAAA;;;;AAAA;;;;;AAAA,OAAAb,qBAAA,AAAAC,gBAAAW,UAAA,AAAAE,mEAAA,AAAAX,qBAAAQ;;AAAA,OAAAX,qBAAA,AAAAC,gBAAAW,UAAA;;;AAAA,sBAAA,AAAAP,gBAAAM,lCAAMQ;AAAN,AAAA,OAAAb,uFAAA,AAAAQ,mEAAA,AAAAP,eAAAI,1JACE,AAACS,4CAAI3C,WAAW0C;;;AADlB;;;;;CAAA,KAAA;;;AAAA,AAAA,OAAAnC,mBAAgB,AAACoC,4CAAIb,eAAK,AAACxB,iBAAOR,qBAAekC;KAEjDC;;AAHH,eAAA,CAAAf,WAAA;;;;AAAA;;;;;AAAA,OAAAK,qBAAA,AAAAC,gBAAAR,UAAA,AAAAS,qDAAA,AAAAC,qBAAAlB;;AAAA,OAAAe,qBAAA,AAAAC,gBAAAR,UAAA;;;AAAA,IAAAW,aAAA,AAAAC,gBAAApB;QAAA,AAAAa,4CAAAM,WAAA,IAAA,/DAAOI;eAAP,AAAAV,4CAAAM,WAAA,IAAA,tEAASK;kBAAT,AAAAX,4CAAAM,WAAA,IAAA,zEAAkBM;AAAlB,AAAA,OAAAJ,eAAA,mFACG,iBAAAtB,qBAAA;oFAAA+B;AAAA,AAAA,YAAA7B,kBAAA,KAAA;AAAA,AAAA,IAAA6B,eAAAA;;AAAA,AAAA,IAAA5B,yBAAA,AAAAC,cAAA2B;AAAA,AAAA,GAAA5B;AAAA,AAAA,IAAA4B,eAAA5B;AAAA,AAAA,GAAA,AAAAE,6BAAA0B;AAAA,IAAAzB,kBAk7EsC,AAAA8D,sBAAArC;IAl7EtCxB,qBAAA,AAAAC,gBAAAF;IAAA0B,WAAA,AAAAtB,uBAAAH;AAAA,AAAA,GAAA,AAAA,iBAAA0B,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAA1B;AAAA,sBAAA,AAAAM,eAAAP,gBAAA2B,jDAAME;AAAN,AAAA,AAAA,AAAApB,uBAAAiB,SACE,AAACI,4CAAI3C,WAAW0C;;AADlB,eAAA,CAAAF,WAAA;;;;AAAA;;;;;AAAA,OAAAjB,qBAAA,AAAAC,gBAAAe,UAAA,AAAAE,mEAAA,AAAAf,qBAAAY;;AAAA,OAAAf,qBAAA,AAAAC,gBAAAe,UAAA;;;AAAA,sBAAA,AAAAX,gBAAAU,lCAAMI;AAAN,AAAA,OAAAb,uFAAA,AAAAY,mEAAA,AAAAX,eAAAQ,1JACE,AAACK,4CAAI3C,WAAW0C;;;AADlB;;;;GAAA,KAAA;;;AAAA,AAAA,OAAAnC,mBAAgB,AAACoC,4CAAIb,eAAK,AAACxB,iBAAOR,qBAAekC;yBADpD,AAAAP,qDAAA,AAAAK,eAAAtB,xFAGGyB;;;AAHH;;;;GAAA,KAAA;;AAAA,AAAA,OAAA1B,mBAA+BF;;IAF3BA,QAMJ,AAACuC,kBAAQvC;AANf,AAOM,OAACwC,8CAAMC,cAAIzC;;AAKrB;;;;uCAAA,vCAAM0C,sFAGHtD;AAHH,AAIE,eAAA,XAAMI;wBAAN,pBACMmD;oBADN,hBAEMC;IACAC,kBAAc,WAAKC;AAAL,AACE,IAAAC,qBAAiB,iBAAAlD,oBAAK,OAASiD;AAAd,AAAA,GAAAjD;AACK,OAACC,qBAAW8C,cAAcE;;AAD/BjD;;;AAAjB,AAAA,oBAAAkD;AAAA,IAAAC,aAAAD;QAAA,AAAA/B,4CAAAgC,WAAA,IAAA,/DAAUtB;QAAV,AAAAV,4CAAAgC,WAAA,IAAA,/DAAYC;QAAZ,AAAAjC,4CAAAgC,WAAA,IAAA,/DAAcE;AAAd,AAEE,QAAA,IAAS,AAACC,yBAAYF,+CAAGC;;AACzBJ;;;AAPxB,AAQE,QAAM1D,JAAIY;IAAAA,QACJ,AAACC,iBAAOT,SAASQ;IADbA,QAEJ,iBAAAE,qBAAA,6DAAAkD;AAAA,AAAA,YAAAhD,kBAAA,KAAA;AAAA,AAAA,IAAAgD,eAAAA;;AAAA,AAAA,IAAA/C,qBAAA,AAAAC,cAAA8C;AAAA,AAAA,GAAA/C;AAAA,AAAA,IAAA+C,eAAA/C;AAAA,AAAA,GAAA,AAAAE,6BAAA6C;AAAA,IAAA5C,kBA25EyC,AAAA8D,sBAAAlB;IA35EzC3C,qBAAA,AAAAC,gBAAAF;IAAA6C,WAAA,AAAAzC,uBAAAH;AAAA,AAAA,GAAA,AAAA,iBAAA6C,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAA7C;AAAA,IAAA8C,aAAA,AAAAxC,eAAAP,gBAAA8C;QAAA,AAAAtC,4CAAAuC,WAAA,IAAA,/DAAO7B;eAAP,AAAAV,4CAAAuC,WAAA,IAAA,tEAAS5B;kBAAT,AAAAX,4CAAAuC,WAAA,IAAA,zEAAkB3B;AAAlB,AAAA,AAAA,AAAAX,uBAAAoC,SAAA,mFACG,iBAAAnD,qBAAA;kFAAAwD;AAAA,AAAA,YAAAtD,kBAAA,KAAA;;AAAA,AAAA,IAAAsD,eAAAA;;AAAA,AAAA,IAAArD,yBAAA,AAAAC,cAAAoD;AAAA,AAAA,GAAArD;AAAA,AAAA,IAAAqD,eAAArD;AAAA,AAAA,GAAA,AAAAE,6BAAAmD;AAAA,IAAAlD,sBA05EsC,AAAA8D,sBAAAZ;IA15EtCjD,yBAAA,AAAAC,gBAAAF;IAAAmD,WAAA,AAAA/C,uBAAAH;AAAA,AAAA,GAAA,AAAA,iBAAAmD,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAnD;AAAA,mBAAA,AAAAM,eAAAP,oBAAAoD,lDAAMM;AAAN,AAAA,AAAA,AAAAjD,uBAAA0C,SACE,AAACrB,4CAAIO,gBAAWqB;;AADlB,eAAA,CAAAN,WAAA;;;;AAAA;;;;;AAAA,OAAA1C,qBAAA,AAAAC,gBAAAwC,UAAA,AAAAE,iEAAA,AAAAxC,qBAAAqC;;AAAA,OAAAxC,qBAAA,AAAAC,gBAAAwC,UAAA;;;AAAA,mBAAA,AAAApC,gBAAAmC,/BAAMQ;AAAN,AAAA,OAAA1C,yFAAA,AAAAqC,iEAAA,AAAApC,eAAAiC,1JACE,AAACpB,4CAAIO,gBAAWqB;;;AADlB;;;;;CAAA,KAAA;;;AAAA,AAAA,OAAAhE,mBAAa,AAACoC,4CAAIb,eAAK,AAACxB,iBAAO0C,kBAAYhB;KAE3CC;;AAHH,eAAA,CAAA0B,WAAA;;;;AAAA;;;;;AAAA,OAAApC,qBAAA,AAAAC,gBAAAkC,UAAA,AAAAG,mDAAA,AAAAnC,qBAAA+B;;AAAA,OAAAlC,qBAAA,AAAAC,gBAAAkC,UAAA;;;AAAA,IAAAI,aAAA,AAAAlC,gBAAA6B;QAAA,AAAApC,4CAAAyC,WAAA,IAAA,/DAAO/B;eAAP,AAAAV,4CAAAyC,WAAA,IAAA,tEAAS9B;kBAAT,AAAAX,4CAAAyC,WAAA,IAAA,zEAAkB7B;AAAlB,AAAA,OAAAJ,eAAA,mFACG,iBAAAtB,qBAAA;kFAAA4D;AAAA,AAAA,YAAA1D,kBAAA,KAAA;AAAA,AAAA,IAAA0D,eAAAA;;AAAA,AAAA,IAAAzD,yBAAA,AAAAC,cAAAwD;AAAA,AAAA,GAAAzD;AAAA,AAAA,IAAAyD,eAAAzD;AAAA,AAAA,GAAA,AAAAE,6BAAAuD;AAAA,IAAAtD,kBA05EsC,AAAA8D,sBAAAR;IA15EtCrD,qBAAA,AAAAC,gBAAAF;IAAAuD,WAAA,AAAAnD,uBAAAH;AAAA,AAAA,GAAA,AAAA,iBAAAuD,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAvD;AAAA,mBAAA,AAAAM,eAAAP,gBAAAwD,9CAAME;AAAN,AAAA,AAAA,AAAAjD,uBAAA8C,SACE,AAACzB,4CAAIO,gBAAWqB;;AADlB,eAAA,CAAAF,WAAA;;;;AAAA;;;;;AAAA,OAAA9C,qBAAA,AAAAC,gBAAA4C,UAAA,AAAAE,iEAAA,AAAA5C,qBAAAyC;;AAAA,OAAA5C,qBAAA,AAAAC,gBAAA4C,UAAA;;;AAAA,mBAAA,AAAAxC,gBAAAuC,/BAAMI;AAAN,AAAA,OAAA1C,yFAAA,AAAAyC,iEAAA,AAAAxC,eAAAqC,1JACE,AAACxB,4CAAIO,gBAAWqB;;;AADlB;;;;GAAA,KAAA;;;AAAA,AAAA,OAAAhE,mBAAa,AAACoC,4CAAIb,eAAK,AAACxB,iBAAO0C,kBAAYhB;yBAD9C,AAAA6B,mDAAA,AAAA/B,eAAA2B,tFAGGxB;;;AAHH;;;;GAAA,KAAA;;AAAA,AAAA,OAAA1B,mBAA+BF;;IAF3BA,QAMJ,AAACuC,kBAAQvC;AANf,AAOM,OAACwC,8CAAMC,cAAIzC;;AAErB;;;iCAAA,jCAAMmE,0EAEH/E;AAFH,mDAGM,2BAAA,OAAA,lCAACC,uBAAYD,9CACb,+DAAA,QAAA,vEAACC,5BACD,OAAC+E;;AAEP;;;;;2BAAA,3BAAMC,8DAIH9E,OAAOH;AAJV,yHAKO,AAACD,8BAAgBC,5EACjB,AAACE,uCAAyBC,5EAC1B,AAACmD,tCACD,OAACyB","names":["rescope.style/remove-comments","css","clojure.string/replace","rescope.style/prefix-element-selectors","prefix","css-rule","?element-split","element-selector","add-prefix","?element","and__5043__auto__","cljs.core/re-matches","rescope.util/prefixed","$","cljs.core/re-seq","iter__5522__auto__","s__44992","cljs.core/LazySeq","temp__5804__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5520__auto__","size__5521__auto__","cljs.core/count","b__44994","cljs.core/chunk-buffer","i__44993","vec__44999","cljs.core/-nth","cljs.core.nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__44991","cljs.core/chunk-rest","vec__45011","cljs.core/first","cljs.core/cons","cljs.core/rest","_","selector","declaration","s__45004","b__45006","i__45005","iter__45003","s__45015","b__45017","i__45016","iter__45014","?elements","cljs.core.map","cljs.core/flatten","cljs.core.apply","cljs.core/str","rescope.style/convert-to-data-*","?attr-split","attr-selector","add-data-*","?attr","temp__5802__auto__","vec__45029","k","x","rescope.util/data-*","s__45034","b__45036","i__45035","vec__45037","iter__45033","vec__45060","s__45043","b__45045","i__45044","iter__45042","s__45064","b__45066","i__45065","iter__45063","?attrs","rescope.style/trim-blank-space","clojure.string/triml","rescope.style/prefix-css","cljs.core/chunk-first"],"sourcesContent":["(ns rescope.style\n  (:require [clojure.string :as str]\n            [rescope.util :as util]))\n\n(defn remove-comments\n  \"Remove comments from a piece of `css`.\"\n  [css]\n  (str/replace css #\"/\\*.*\\*/\" \"\"))\n\n;; TODO: support @import, @media, etc. special rules\n(defn prefix-element-selectors\n  \"Super hairy, write-only code for adding a `prefix` to all element selectors\n  in a piece of `css`.\"\n  [prefix css]\n  (let [css-rule         #\"([^{]+)(\\s*\\{[^}]*\\}\\s*)\"\n        ?element-split   #\"([\\s\\(\\)]+)|([^\\s\\(\\)]+)\"\n        element-selector #\"([a-zA-Z-]+).*\"\n        add-prefix       (fn [?element]\n                           (if (and (string? ?element)\n                                    (re-matches element-selector ?element))\n                             (util/prefixed prefix ?element)\n                             ?element))]\n    (as-> css $\n          (re-seq css-rule $)\n          (for [[_ selector declaration] $]\n            [(for [?elements (map rest (re-seq ?element-split selector))]\n               (map add-prefix ?elements))\n             declaration])\n          (flatten $)\n          (apply str $))))\n\n;; TODO: support attr(...) CSS function\n;; https://developer.mozilla.org/en-US/docs/Web/CSS/attr\n;; https://css-tricks.com/css-attr-function-got-nothin-custom-properties/\n(defn convert-to-data-*\n  \"More Perl-wannabe, garbage code for prefixing data-* to attribute selectors\n  in a piece of `css`.\"\n  [css]\n  (let [css-rule      #\"([^{]+)(\\s*\\{[^}]*\\}\\s*)\"\n        ?attr-split   #\"(\\[[^\\]]+\\])|([^\\[]+)\"\n        attr-selector #\"\\[([a-zA-Z]+)(.*)\"\n        add-data-*    (fn [?attr]\n                        (if-let [[_ k x] (and (string? ?attr)\n                                              (re-matches attr-selector ?attr))]\n                          (str \"[\" (util/data-* k) x)\n                          ?attr))]\n    (as-> css $\n          (re-seq css-rule $)\n          (for [[_ selector declaration] $]\n            [(for [?attrs (map rest (re-seq ?attr-split selector))]\n               (map add-data-* ?attrs))\n             declaration])\n          (flatten $)\n          (apply str $))))\n\n(defn trim-blank-space\n  \"Remove superfluous newlines.\"\n  [css]\n  (-> (str/replace css #\" +\\n\" \"\\n\")                        ; line-end spaces\n      (str/replace #\"\\n\\n+\" \"\\n\\n\")                         ; multiple newlines\n      (str/triml)))\n\n(defn prefix-css\n  \"Patch a piece of `css` written for the original document structure so that it\n  matches the postprocessed hiccup. Will remove comments, add `prefix` to\n  element selectors, and convert all attribute selectors to the data-* style.\"\n  [prefix css]\n  (->> (remove-comments css)\n       (prefix-element-selectors prefix)\n       (convert-to-data-*)\n       (trim-blank-space)))\n"]}